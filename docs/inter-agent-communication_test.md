Developing the test for the full inter-agent communication loop in `test_inter_agent.py`.

 Latest context for `EngineManager`, `BaseEngine`, `Event` model, and `EventBus`. 
 
 Here's a plan to implement the test:

1.  **Patch `BaseEngine.publish_action_output`**:
    *   We need to mock `BaseEngine.publish_action_output` to intercept events that agents try to publish. This will allow us to verify that the correct events are generated by the source agents.
    *   We'll use `unittest.mock.AsyncMock` for this, as `publish_action_output` is an async method.

2.  **Patch `BaseEngine.handle_delivered_event`**:
    *   Similarly, we need to mock `BaseEngine.handle_delivered_event` on the *target* agents' engines. This will allow us to verify that the `EngineManager` correctly routes and transforms events to the intended recipients.
    *   This will also be an `AsyncMock`.

3.  **Simulate Scenario Progression**:
    *   After `scenario_runner.start_scenario()`, the `EngineManager` should have triggered the initial event (e.g., `"request_scene_update"` to the narrator) based on the `event_flow`.
    *   We'll need to manually "drive" the scenario forward by making the mocked engines "respond" to these events.
    *   For example, when the narrator's `handle_delivered_event` is called with `"request_scene_update"`, we'll make its mocked `publish_action_output` get called with a `"scene_description_generated"` event.

4.  **Assertions**:
    *   **Event Publishing**: Assert that `publish_action_output` is called on the source agent's engine with the expected `scenario_run_id`, `output_type`, and data.
    *   **Event Routing and Transformation**:
        *   Assert that `EngineManager._handle_agent_action_output` (or the newer `_handle_agent_generated_event` if that's the one being used by the `event_flow` in the test) is called.
        *   Assert that `EngineManager.deliver_event_to_agent` is called with the correct `target_agent_id`, transformed `event_type` (e.g., `"scene_description_updated"`), and payload.
    *   **Event Delivery**: Assert that `handle_delivered_event` is called on the target agent's engine with the correctly transformed event.
    *   **Sequence of Events**: Verify the calls happen in the expected order according to the `event_flow`.